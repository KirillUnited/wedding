function UpdateStepDate(n,t){var f=$(n.target),i=$(t.item),r=$(f).data("period"),u;$(i).data("number",r);u=$(i).next();u.length>0?(r=$(u).data("days"),$(i).data("days",r)):(u=$(i).prev(),r=$(u).data("days"),$(i).data("days",r))}function HideShowStep(n){if(onDeleteItem=!0,CheckUser(!0)){onDeleteItem=!1;var t=$(n).parents(".row");switch($(n).data("action")){case"delete":$(t[0]).addClass("section-deleted");$(t[0]).find(".check-box-container").addClass("hide");$(t[0]).data("enable","no");$(n).data("action","restore");$(n).children(".fa").removeClass("fa-trash-o").addClass("fa-plus");break;case"restore":$(n).data("action","delete");$(n).children(".fa").removeClass("fa-plus").addClass("fa-trash-o");$(t[0]).removeClass("section-deleted").removeClass("visible");$(t[0]).find(".check-box-container").removeClass("hide");$(t[0]).data("enable","yes");CheckDeletedItemsExist()}SaveUserChecklist()}}function ShowDeletedItems(n){var i=$(".section-deleted"),t;if(i.length>0)switch($(n).data("action")){case"show":for($(n).find("i").removeClass("fa-toggle-off").addClass("fa-toggle-on"),t=0;t<i.length;t++)$(i[t]).addClass("visible");$(n).data("action","hide");break;case"hide":for($(n).find("i").removeClass("fa-toggle-on").addClass("fa-toggle-off"),t=0;t<i.length;t++)$(i[t]).removeClass("visible");$(n).data("action","show")}}function CheckDeletedItemsExist(){!$(".section-deleted").length>0&&$("#deleted-items i").removeClass("fa-toggle-on").addClass("fa-toggle-off").data("action","show")}function MarkStep(n){var t,i;if(onCompletedItem=!0,CheckUser(!0)){t=$(n).parents(".row");switch($(n).data("action")){case"mark":$(t[0]).data("status","closed");$(n).data("action","unmark");i=$(t[0]).find(".fa-square-o");$(i).removeClass("fa-square-o").addClass("fa-check-square-o");break;case"unmark":$(t[0]).data("status","active");$(n).data("action","mark");i=$(t[0]).find(".fa-check-square-o");$(i).removeClass("fa-check-square-o").addClass("fa-square-o")}CheckOverdueForStep(t);SaveUserChecklist()}}function CalculateAllStepDates(n){for(var i,t=0;t<accordionsArray.length;t++)for(i=$(accordionsArray[t]).children(".row"),s=0;s<i.length;s++){var r=$(i[s]),u=$(r).data("days"),f=moment(n).add(u,"days").startOf("day");$(r).find(".date-picker").data("DateTimePicker").date(moment(f).format("MM/DD/YYYY"))}}function SortStepsWithinSection(n,t){var i=$(t).detach(),u=$(accordionsArray[n-1]).children(".row"),r,f,e;if(u.length>0)for(r=0;r<u.length;r++){if(f=$(i).data("days"),e=$(u[r]).data("days"),e>=f){$(u[r]).before(i);break}$(u[r]).after(i)}else $(accordionsArray[n-1]).prepend(i);$(".connectedSortable").sortable("refresh");CheckOverdueForStep(i);window.scrollTo(0,i[0].offsetTop-scrollOffset)}function CalculateStepSectionNumber(n){return n<=-270?1:n<=-180&&n>-270?2:n<=-90&&n>-180?3:n<=-60&&n>-90?4:n<=-42&&n>-60?5:n<=-21&&n>-42?6:n<=-7&&n>-21?7:n<=-1&&n>-7?8:n===0?9:10}function ClearAllDates(){for(var t,n=0;n<accordionsArray.length;n++)for(t=$(accordionsArray[n]).children(".row"),s=0;s<t.length;s++)$(t[s]).find(".date-picker").data("DateTimePicker").date(null)}function CheckOverdueForAll(){for(var n,i,r,t=0;t<accordionsArray.length;t++)for(rowArray=$(accordionsArray[t]).children(".row"),n=0;n<rowArray.length;n++)$(rowArray[n]).data("enable")==="yes"&&(i=moment().startOf("day"),r=$(rowArray[n]).find(".date-picker").data("DateTimePicker").date().startOf("day"),r<i?$(rowArray[n]).find(".item-status").addClass("visible"):$(rowArray[n]).find(".item-status").removeClass("visible"))}function CheckOverdueForStep(n){if(weddingDate){var t=moment().startOf("day"),i=$(n).find(".date-picker").data("DateTimePicker").date().startOf("day");i<t?$(n).find(".item-status").addClass("visible"):$(n).find(".item-status").removeClass("visible")}}function CheckUser(n){var t=$("#isAuth").val()==="true"?!0:!1;return t?!0:(n&&SignInModalShow(!0),!1)}function ShowAdToDo(n){CheckUser(!0)&&($("#new-step-title").val(""),$("#new-step-text").val(""),$("#ad-to-do-form").modal("show"),section=$(n).data("owner"))}function AddUserContent(){var t=$("#new-step-title").val(),i=$("#new-step-text").val(),f,e;if(t!==""&&!/^ /i.test(t)&&i!==""&&!/^ /i.test(i)){var n=$("#"+section).children(".row")[0],o=$(n).data("days"),r=parseInt($("#stepsCount").val());r++;$("#stepsCount").val(r);var s=$(n).find(".date-picker").data("DateTimePicker").date(),h=$(section).data("period"),u=$("#adtodo-template").html();Mustache.parse(u);f=Mustache.render(u,{Title:t,Text:i,Number:h,Days:o,ToolsIndex:r});$("#"+section).prepend(f).accordion("refresh");n=$("#"+section).children(".row")[0];e=$(n).find(".date-picker");$(e).datetimepicker({format:"L",defaultDate:s}).on("dp.hide",function(n){if(weddingDate){var i=moment.duration(n.date-weddingDate).asDays(),t=$(n.target).parents(".row");$(t).data("days",i);$(t).data("number",CalculateStepSectionNumber(i));SortStepsWithinSection($(t).data("number"),t);SaveUserChecklist()}});CheckOverdueForStep(n);$("#ad-to-do-form").modal("hide");window.scrollTo(0,n.offsetTop-scrollOffset);SaveUserChecklist()}}function OpenLink(n){onLinkClick=!0;var t=$(n).attr("href");window.open(t)}function OpenSignInFormOnChartImage(){onChartImageClick=!0;CheckUser(!0)}function CheckElementEvent(n,t){if(onDeleteItem){n.preventDefault();onDeleteItem=!1;return}if(onCompletedItem){n.preventDefault();onCompletedItem=!1;return}if(onBudgetEner){n.preventDefault();onBudgetEner=!1;return}if(onStepDateEner){n.preventDefault();onStepDateEner=!1;return}if(onArrowsClick){n.preventDefault();onArrowsClick=!1;return}if(onLinkClick){n.preventDefault();onLinkClick=!1;return}if(onChartImageClick){n.preventDefault();onChartImageClick=!1;return}var i=$(t.newHeader).parent().find(".active-view"),r=$(t.newHeader).parent().find(".check-box"),f=$(t.oldHeader).parent().find(".active-view"),e=$(t.oldHeader).parent().find(".check-box"),u=$(t.newHeader).parent().find(".fa")[1],o=$(t.oldHeader).parent().find(".fa")[1];i[0]!==f[0]?($(i).addClass("visiblef"),$(r).addClass("hide"),$(f).removeClass("visiblef"),$(e).removeClass("hide"),$(u).addClass("fa-chevron-up").removeClass("fa-chevron-down"),$(o).removeClass("fa-chevron-up").addClass("fa-chevron-down")):$(i).hasClass("visiblef")?($(i).removeClass("visiblef"),$(r).removeClass("hide"),$(u).addClass("fa-chevron-down").removeClass("fa-chevron-up")):($(i).addClass("visiblef"),$(r).addClass("hide"),$(u).addClass("fa-chevron-up").removeClass("fa-chevron-down"))}function UpdateCheckList(){window.location.reload()}function SetStepDate(){onStepDateEner=!0}function EnterBudget(){onBudgetEner=!0}function PlaceBudget(n){var t;if(CheckUser(!1)){var i=null,r=$(n).val(),u=$(n).data("chart");for(t=0;t<chartsArray.length;t++)if($(chartsArray[t].canvas).attr("id")===u){i=chartsArray[t];break}AddBudgetToTheChart(i,null,parseInt(r))}}function AddBudgetToTheChart(n,t,i){n.data.datasets[1].data=[];n.data.labels.push(t);n.data.datasets[1].data.push(new function(){this.x=i;this.y=0});n.data.datasets[1].data.push(new function(){this.x=i;this.y=100});n.update()}function PlaceMarker(n){var t=$(".visible").last();$(".marker").css("top",t[0].offsetParent.offsetTop+10+"px");n&&window.scrollTo(0,t[0].offsetParent.offsetTop-scrollOffset)}function CheckListStep(n,t,i,r,u,f,e,o){self=this;self.Id=n;self.Title=t;self.Text=i;self.StepTimePeriod=r;self.IsEnabled=u;self.IsCompleted=f;self.DaysB4Wedding=e;self.Budget=o}function SaveUserChecklist(){var i,t,n;if(request=!0,CheckUser(!1)){for(WeddingChecklistModel.WeddingDate=$("#checklist-datepicker").val(),WeddingChecklistModel.CheckListSteps=[],i=0;i<accordionsArray.length;i++)for(t=$(accordionsArray[i]).children(".row"),n=0;n<t.length;n++){var r=$(t[n]).attr("id"),u=$(t[n]).data("status")==="active"?!1:!0,f=$(t[n]).data("enable")==="yes"?!0:!1,e=$(t[n]).data("number"),o=$(t[n]).find(".step-title").text(),s=$(t[n]).find(".step-text").text(),h=$(t[n]).data("days"),c=$(t[n]).find(".budget").val();WeddingChecklistModel.CheckListSteps.push(new CheckListStep(r,o,s,e,f,u,h,c))}$.post("/users/SaveChecklist",WeddingChecklistModel,function(){request=!1})}}var WeddingChecklistModel;(function(n,t){typeof exports=="object"&&exports&&typeof exports.nodeName!="string"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(n.Mustache={},t(n.Mustache))})(this,function(n){function f(n){return typeof n=="function"}function l(n){return u(n)?"array":typeof n}function o(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function s(n,t){return n!=null&&typeof n=="object"&&t in n}function a(n,t){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(t)}function y(n,t){return v.call(n,t)}function w(n){return!y(p,n)}function k(n){return String(n).replace(/[&<>"'`=\/]/g,function(n){return b[n]})}function it(t,i){function lt(){if(ft&&!p)while(y.length)delete a[y.pop()];else y=[];ft=!1;p=!1}function ht(n){if(typeof n=="string"&&(n=n.split(g,2)),!u(n)||n.length!==2)throw new Error("Invalid tags: "+n);et=new RegExp(o(n[0])+"\\s*");v=new RegExp("\\s*"+o(n[1]));st=new RegExp("\\s*"+o("}"+n[1]))}var et,v,st,f,c,e,s,b,ot,l,k,ct;if(!t)return[];var it=[],a=[],y=[],ft=!1,p=!1;for(ht(i||n.tags),f=new r(t);!f.eos();){if(c=f.pos,s=f.scanUntil(et),s)for(k=0,ct=s.length;k<ct;++k)b=s.charAt(k),w(b)?y.push(a.length):p=!0,a.push(["text",b,c,c+1]),c+=1,b==="\n"&&lt();if(!f.scan(et))break;if(ft=!0,e=f.scan(tt)||"name",f.scan(d),e==="="?(s=f.scanUntil(h),f.scan(h),f.scanUntil(v)):e==="{"?(s=f.scanUntil(st),f.scan(nt),f.scanUntil(v),e="&"):s=f.scanUntil(v),!f.scan(v))throw new Error("Unclosed tag at "+f.pos);if(ot=[e,s,c,f.pos],a.push(ot),e==="#"||e==="^")it.push(ot);else if(e==="/"){if(l=it.pop(),!l)throw new Error('Unopened section "'+s+'" at '+c);if(l[1]!==s)throw new Error('Unclosed section "'+l[1]+'" at '+c);}else e==="name"||e==="{"||e==="&"?p=!0:e==="="&&ht(s)}if(l=it.pop(),l)throw new Error('Unclosed section "'+l[1]+'" at '+f.pos);return ut(rt(a))}function rt(n){for(var u=[],t,i,r=0,f=n.length;r<f;++r)t=n[r],t&&(t[0]==="text"&&i&&i[0]==="text"?(i[1]+=t[1],i[3]=t[3]):(u.push(t),i=t));return u}function ut(n){for(var u=[],r=u,i=[],t,e,f=0,o=n.length;f<o;++f){t=n[f];switch(t[0]){case"#":case"^":r.push(t);i.push(t);r=t[4]=[];break;case"/":e=i.pop();e[5]=t[2];r=i.length>0?i[i.length-1][4]:u;break;default:r.push(t)}}return u}function r(n){this.string=n;this.tail=n;this.pos=0}function i(n,t){this.view=n;this.cache={".":this.view};this.parent=t}function t(){this.cache={}}var c=Object.prototype.toString,u=Array.isArray||function(n){return c.call(n)==="[object Array]"},v=RegExp.prototype.test,p=/\S/,b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},d=/\s*/,g=/\s+/,h=/\s*=/,nt=/\s*\}/,tt=/#|\^|\/|>|\{|&|=|!/,e;return r.prototype.eos=function(){return this.tail===""},r.prototype.scan=function(n){var i=this.tail.match(n),t;return!i||i.index!==0?"":(t=i[0],this.tail=this.tail.substring(t.length),this.pos+=t.length,t)},r.prototype.scanUntil=function(n){var i=this.tail.search(n),t;switch(i){case-1:t=this.tail;this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,i);this.tail=this.tail.substring(i)}return this.pos+=t.length,t},i.prototype.push=function(n){return new i(n,this)},i.prototype.lookup=function(n){var h=this.cache,i,r,t,u,e,o;if(h.hasOwnProperty(n))i=h[n];else{for(r=this,o=!1;r;){if(n.indexOf(".")>0)for(t=r.view,u=n.split("."),e=0;t!=null&&e<u.length;)e===u.length-1&&(o=s(t,u[e])||a(t,u[e])),t=t[u[e++]];else t=r.view[n],o=s(r.view,n);if(o){i=t;break}r=r.parent}h[n]=i}return f(i)&&(i=i.call(this.view)),i},t.prototype.clearCache=function(){this.cache={}},t.prototype.parse=function(t,i){var u=this.cache,f=t+":"+(i||n.tags).join(":"),r=u[f];return r==null&&(r=u[f]=it(t,i)),r},t.prototype.render=function(n,t,r,u){var f=this.parse(n,u),e=t instanceof i?t:new i(t);return this.renderTokens(f,e,r,n,u)},t.prototype.renderTokens=function(n,t,i,r,u){for(var h="",e,o,f,s=0,c=n.length;s<c;++s)f=undefined,e=n[s],o=e[0],o==="#"?f=this.renderSection(e,t,i,r):o==="^"?f=this.renderInverted(e,t,i,r):o===">"?f=this.renderPartial(e,t,i,u):o==="&"?f=this.unescapedValue(e,t):o==="name"?f=this.escapedValue(e,t):o==="text"&&(f=this.rawValue(e)),f!==undefined&&(h+=f);return h},t.prototype.renderSection=function(n,t,i,r){function l(n){return c.render(n,t,i)}var c=this,o="",e=t.lookup(n[1]),s,h;if(e){if(u(e))for(s=0,h=e.length;s<h;++s)o+=this.renderTokens(n[4],t.push(e[s]),i,r);else if(typeof e=="object"||typeof e=="string"||typeof e=="number")o+=this.renderTokens(n[4],t.push(e),i,r);else if(f(e)){if(typeof r!="string")throw new Error("Cannot use higher-order sections without the original template");e=e.call(t.view,r.slice(n[3],n[5]),l);e!=null&&(o+=e)}else o+=this.renderTokens(n[4],t,i,r);return o}},t.prototype.renderInverted=function(n,t,i,r){var f=t.lookup(n[1]);if(!f||u(f)&&f.length===0)return this.renderTokens(n[4],t,i,r)},t.prototype.renderPartial=function(n,t,i,r){if(i){var u=f(i)?i(n[1]):i[n[1]];if(u!=null)return this.renderTokens(this.parse(u,r),t,i,u)}},t.prototype.unescapedValue=function(n,t){var i=t.lookup(n[1]);if(i!=null)return i},t.prototype.escapedValue=function(t,i){var r=i.lookup(t[1]);if(r!=null)return n.escape(r)},t.prototype.rawValue=function(n){return n[1]},n.name="mustache.js",n.version="3.0.1",n.tags=["{{","}}"],e=new t,n.clearCache=function(){return e.clearCache()},n.parse=function(n,t){return e.parse(n,t)},n.render=function(n,t,i,r){if(typeof n!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+l(n)+'" was given as the first argument for mustache#render(template, view, partials)');return e.render(n,t,i,r)},n.to_html=function(t,i,r,u){var e=n.render(t,i,r);if(f(u))u(e);else return e},n.escape=k,n.Scanner=r,n.Context=i,n.Writer=t,n});var request=!1,onDeleteItem=!1,onCompletedItem=!1,onBudgetEner=!1,onStepDateEner=!1,onArrowsClick=!1,onLinkClick=!1,onChartImageClick=!1,weddingDate=null,section=null,scrollOffset=100,chartsArray,accordionsArray=["#accordion-12m","#accordion-9m","#accordion-6m","#accordion-3m","#accordion-2m","#accordion-6w","#accordion-3w","#accordion-1w","#accordion-wd","#accordion-hm"];$(function(){var n,u,r,f,t,i,e;for(isChecklist=!0,n=0;n<accordionsArray.length;n++)$(accordionsArray[n]).accordion({header:"> div > div",collapsible:!0,active:!1,icons:!1,heightStyle:"content",beforeActivate:function(n,t){CheckElementEvent(n,t)}}).sortable({connectWith:".connectedSortable",axis:"y",handle:".fa-arrows",stop:function(n,t){t.item.children(".fa-plus").triggerHandler("focusout");$(".connectedSortable").accordion("refresh")},update:function(n,t){if(UpdateStepDate(n,t),weddingDate){var i=$(t.item).data("days"),r=moment(weddingDate).add(i,"days").startOf("day");$(t.item).find(".date-picker").data("DateTimePicker").date(moment(r).format("MM/DD/YYYY"));CheckOverdueForStep(t.item)}CheckUser(!1)&&(request||SaveUserChecklist())}});$("#checklist-datepicker").datetimepicker({format:"L"}).on("dp.change",function(n){weddingDate=n.date._d;weddingDate&&(CalculateAllStepDates(weddingDate),CheckOverdueForAll(),SaveUserChecklist())});for(n=0;n<accordionsArray.length;n++)for(u=$(accordionsArray[n]).children(".row"),r=0;r<u.length;r++){f=$(u[r]).find(".date-picker");$(f).datetimepicker({format:"L"}).on("dp.hide",function(n){if(weddingDate){var i=moment.duration(n.date-weddingDate).asDays(),t=$(n.target).parents(".row");$(t).data("days",i);$(t).data("number",CalculateStepSectionNumber(i));SortStepsWithinSection($(t).data("number"),t);SaveUserChecklist()}})}for(CheckUser(!1)&&(weddingDate=$("#checklist-datepicker").val(),weddingDate?($("#checklist-datepicker").data("DateTimePicker").date(moment(weddingDate,"MM/DD/YYYY")),weddingDate=$("#checklist-datepicker").data("DateTimePicker").date(),CalculateAllStepDates(weddingDate),CheckOverdueForAll()):ClearAllDates()),$(".ui-sortable-handle").click(function(){onArrowsClick=!0}),chartsArray=[],t=[],i=$(".chart-container"),n=0;n<i.length;n++)t.push(new function(){this.minPrice=$(i[n]).data("minprice");this.averagePrice=$(i[n]).data("averageprice");this.maxPrice=$(i[n]).data("maxprice");this.minProc=$(i[n]).data("minproc");this.averageProc=$(i[n]).data("averageproc");this.maxProc=$(i[n]).data("maxproc");this.budget=$(i[n]).data("budget")===""?null:$(i[n]).data("budget");this.ChartId=$(i[n]).data("chartid")});for(n=0;n<t.length;n++)e=document.getElementById(t[n].ChartId),chartsArray.push(new Chart(e,{type:"line",responsive:!0,data:{datasets:[{label:"distribution",data:[{x:t[n].minPrice,y:t[n].minProc},{x:t[n].averagePrice,y:t[n].averageProc},{x:t[n].maxPrice,y:t[n].maxProc}],borderColor:"#068887",borderWidth:2,fill:"false",backgroundColor:"white"},{label:"budget",data:[{x:t[n].budget,y:0},{x:t[n].budget,y:t[n].averageProc}],borderWidth:1,borderColor:"#ffaa62",fill:"false",backgroundColor:"white"}]},options:{scales:{xAxes:[{type:"linear",scaleLabel:{display:!0,labelString:"price"},gridLines:{display:!1},ticks:{stepSize:Math.ceil((t[n].maxPrice-t[n].minPrice)/6)}}],yAxes:[{type:"linear",scaleLabel:{display:!0,labelString:"% of contracts"},gridLines:{display:!0},ticks:{min:0,max:t[n].averageProc,stepSize:Math.ceil(t[n].averageProc/6)}}]},tooltips:{callbacks:{title:function(n,t){var i=t.datasets[n[0].datasetIndex].title||"";return i+("price: "+n[0].xLabel)},label:function(n,t){var i=t.datasets[n.datasetIndex].label||"";return""}}}}}));$("#check-list").css("opacity",1)});WeddingChecklistModel={WeddingDate:null,CheckListSteps:[]}